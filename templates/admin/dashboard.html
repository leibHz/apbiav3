{% extends "base.html" %}

{% block title %}Painel Administrativo - APBIA{% endblock %}

{% block extra_css %}
{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h2>
            <i class="fas fa-tachometer-alt"></i> Painel Administrativo
        </h2>
        <p>Visão geral e gerenciamento do sistema</p>
    </div>
    
    <!-- Estatísticas -->
    <div class="stats-grid">
        <div class="stat-card primary">
            <div class="stat-card-content">
                <div class="stat-card-info">
                    <h6>Total de Usuários</h6>
                    <h2>{{ stats.total_usuarios }}</h2>
                </div>
                <i class="fas fa-users stat-card-icon primary"></i>
            </div>
        </div>
        
        <div class="stat-card success">
            <div class="stat-card-content">
                <div class="stat-card-info">
                    <h6>Participantes</h6>
                    <h2>{{ stats.participantes }}</h2>
                </div>
                <i class="fas fa-user-graduate stat-card-icon success"></i>
            </div>
        </div>
        
        <div class="stat-card info">
            <div class="stat-card-content">
                <div class="stat-card-info">
                    <h6>Orientadores</h6>
                    <h2>{{ stats.orientadores }}</h2>
                </div>
                <i class="fas fa-chalkboard-teacher stat-card-icon info"></i>
            </div>
        </div>
        
        <div class="stat-card {% if stats.ia_status %}success{% else %}danger{% endif %} with-button">
            <div class="stat-card-content">
                <div class="stat-card-info">
                    <h6>Status da IA</h6>
                    <h2>{{ 'ATIVA' if stats.ia_status else 'OFFLINE' }}</h2>
                </div>
                <i class="fas fa-robot stat-card-icon {% if stats.ia_status %}success{% else %}danger{% endif %}"></i>
            </div>
            <div class="stat-card-button">
                <button class="btn-toggle-ia" id="toggleIABtn">
                    <i class="fas fa-power-off"></i> {{ 'Desativar' if stats.ia_status else 'Ativar' }}
                </button>
            </div>
        </div>
    </div>
    
    <!-- Ações Rápidas -->
    <div class="acoes-rapidas">
        <div class="acoes-header">
            <i class="fas fa-bolt"></i> Ações Rápidas
        </div>
        <div class="acoes-grid">
            <a href="{{ url_for('admin.usuarios') }}" class="btn-acao primary">
                <i class="fas fa-users"></i> Gerenciar Usuários
            </a>
            <a href="{{ url_for('admin.orientacoes') }}" class="btn-acao warning">
                <i class="fas fa-user-friends"></i> Gerenciar Orientações
            </a>
            <a href="{{ url_for('admin.configuracoes') }}" class="btn-acao secondary">
                <i class="fas fa-cog"></i> Configurações
            </a>
            <a href="{{ url_for('admin.gemini_stats_page') }}" class="btn-acao info">
                <i class="fas fa-chart-line"></i> Estatísticas Gemini
            </a>
            <button class="btn-acao success" onclick="document.getElementById('addUserModal').classList.add('active')">
                <i class="fas fa-user-plus"></i> Adicionar Usuário
            </button>
        </div>
    </div>
    
    <!-- Usuários Recentes -->
    <div class="usuarios-recentes">
        <div class="table-header">
            <i class="fas fa-user-friends"></i> Usuários Recentes
        </div>
        <div class="table-wrapper">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Email</th>
                        <th>Tipo</th>
                        <th>BP</th>
                        <th>Data Criação</th>
                    </tr>
                </thead>
                <tbody>
                    {% for usuario in usuarios[:10] %}
                    <tr>
                        <td>{{ usuario.id }}</td>
                        <td>{{ usuario.nome_completo }}</td>
                        <td>{{ usuario.email }}</td>
                        <td>
                            {% if usuario.tipo_usuario_id == 1 %}
                            <span class="badge danger">
                                <i class="fas fa-shield-alt"></i> Admin
                            </span>
                            {% elif usuario.tipo_usuario_id == 2 %}
                            <span class="badge success">
                                <i class="fas fa-user-graduate"></i> Participante
                            </span>
                            {% elif usuario.tipo_usuario_id == 3 %}
                            <span class="badge info">
                                <i class="fas fa-chalkboard-teacher"></i> Orientador
                            </span>
                            {% else %}
                            <span class="badge secondary">
                                <i class="fas fa-user"></i> Visitante
                            </span>
                            {% endif %}
                        </td>
                        <td>{{ usuario.numero_inscricao or '-' }}</td>
                        <td>{{ usuario.data_criacao.strftime('%d/%m/%Y') if usuario.data_criacao else '-' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal Adicionar Usuário -->
<div class="modal-overlay" id="addUserModal">
    <div class="modal">
        <div class="modal-header">
            <h5>
                <i class="fas fa-user-plus"></i> Adicionar Novo Usuário
            </h5>
            <button class="modal-close" onclick="document.getElementById('addUserModal').classList.remove('active')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="addUserForm">
                <div class="form-group">
                    <label class="form-label">Nome Completo</label>
                    <input type="text" class="form-control" name="nome_completo" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" name="email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Senha</label>
                    <input type="password" class="form-control" name="senha" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Tipo de Usuário</label>
                    <select class="form-select" name="tipo_usuario_id" required>
                        {% for tipo in tipos_usuario %}
                        <option value="{{ tipo.id }}">{{ tipo.nome }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">BP (Número de Inscrição)</label>
                    <input type="text" 
                           class="form-control" 
                           name="numero_inscricao"
                           maxlength="12"
                           placeholder="BP12345678X"
                           style="text-transform: uppercase;">
                    <small class="form-text">Obrigatório para participantes e orientadores</small>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-cancelar" onclick="document.getElementById('addUserModal').classList.remove('active')">Cancelar</button>
            <button type="button" class="btn btn-salvar" id="saveUserBtn">
                <i class="fas fa-save"></i> Salvar
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/admin_dashboard.js') }}"></script>
{% endblock %}